<!DOCTYPE html>
<html>
<head>
<title>Azure IoT Foundation.zh_cn.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="azure-iot-%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0"><strong>Azure IoT 基础学习</strong></h1>
<p>此动手实验室旨在向各位介绍以下核心 Azure IoT 服务：</p>
<ul>
<li>Azure IoT Hub</li>
<li>Azure Device Provisioning Service (DPS)</li>
<li>Azure IoT Edge, IoT Edge Runtime &amp; Edge Modules</li>
<li>Azure Data Explorer (ADX)</li>
<li>Azure Stream Analytics (ASA)</li>
</ul>
<p>还将通过以下技术配合实践：</p>
<ul>
<li>Visual Studio Code</li>
<li>Azure Virtual Machines</li>
<li>Ubuntu 18</li>
<li>Bash</li>
</ul>
<p>这些服务是物联网整体解决方案的一部分。 该动手实验用简单的方法介绍了这些服务，可以让不同技术经验的各位学习。</p>
<p>各位需要了解 Azure 门户 <a href="https://portal.azure.com/">https://portal.azure.com</a></p>
<p>熟悉 Azure 的一个好方法是使用 Microsoft Learn 模块和学习路径。 您可以通过以下链接阅读更多信息：<a href="https://docs.microsoft.com/en-us/learn/certifications/exams/az-900">https://docs.microsoft.com/en-us/learn/certifications/exams/az-900</a></p>
<p>课程内容</p>
<!-- @import "[TOC]" {cmd="toc" depthFrom=2 depthTo=6 orderedList=false} -->
<!-- code_chunk_output -->
<ul>
<li><a href="#azure-iot-%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0"><strong>Azure IoT 基础学习</strong></a>
<ul>
<li><a href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><strong>准备工作</strong></a>
<ul>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%B8%80-%E5%AE%89%E8%A3%85-vs-code"><strong>任务一: 安装 VS Code</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%BA%8C-%E5%AE%89%E8%A3%85-vs-code-%E7%9B%B8%E5%85%B3%E6%8F%92%E4%BB%B6"><strong>任务二: 安装 VS Code 相关插件</strong></a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E4%B8%80-%E8%AE%A4%E8%AF%86-azure-iot-%E4%B8%AD%E5%BF%83%E9%85%8D%E7%BD%AE%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9"><strong>实验一: 认识 Azure IoT 中心配置相关内容</strong></a>
<ul>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%B8%80-%E9%80%9A%E8%BF%87-azure-%E9%97%A8%E6%88%B7%E9%85%8D%E7%BD%AE-iot-%E4%B8%AD%E5%BF%83"><strong>任务一: 通过 Azure 门户配置 IoT 中心</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%BA%8C-%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%85%8D%E7%BD%AE-iot-hub"><strong>任务二: 通过命令行配置 IoT Hub</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%B8%89-%E9%80%9A%E8%BF%87-vs-code-%E9%85%8D%E7%BD%AE-iot-hub"><strong>任务三: 通过 VS Code 配置 IoT Hub</strong></a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E4%BA%8C-azure-iot-hub-%E8%AE%BE%E5%A4%87%E9%A2%84%E9%85%8D%E6%9C%8D%E5%8A%A1-dps"><strong>实验二: Azure IoT Hub 设备预配服务 (DPS)</strong></a>
<ul>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%B8%80-%E9%83%A8%E7%BD%B2-dps"><strong>任务一: 部署 DPS</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%BA%8C-%E9%93%BE%E6%8E%A5-iot-hub-%E5%88%B0-dps"><strong>任务二: 链接 IoT Hub 到 DPS</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%B8%89-%E5%88%9B%E5%BB%BA-individual-enrollment"><strong>任务三: 创建 Individual Enrollment</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E5%9B%9B%E6%94%B6%E9%9B%86-individual-enrollment-%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><strong>任务四：收集 Individual Enrollment 详细信息</strong></a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E4%B8%89%E5%88%9B%E5%BB%BA%E5%9F%BA%E4%BA%8E-ubuntu-%E7%9A%84-azure-iot-edge-%E8%AE%BE%E5%A4%87"><strong>实验三：创建基于 Ubuntu 的 Azure IoT Edge 设备</strong></a>
<ul>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%B8%80-%E7%A1%AE%E4%BF%9D-azure-resource-provider-%E5%B7%B2%E7%BB%8F%E6%B3%A8%E5%86%8C"><strong>任务一: 确保 Azure Resource Provider 已经注册</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%BA%8C-%E5%88%9B%E5%BB%BA-vm-%E4%BB%A5%E6%89%98%E7%AE%A1-iot-edge-%E8%AE%BE%E5%A4%87"><strong>任务二: 创建 VM 以托管 IoT Edge 设备</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%B8%89-%E9%93%BE%E6%8E%A5%E5%88%9B%E5%BB%BA%E5%A5%BD%E7%9A%84-unbuntu-%E8%99%9A%E6%8B%9F%E6%9C%BA"><strong>任务三: 链接创建好的 Unbuntu 虚拟机</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E5%9B%9B-%E5%AE%89%E8%A3%85-azure-iot-edge-%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B9%B6%E8%BF%9E%E6%8E%A5%E8%AE%BE%E5%A4%87"><strong>任务四: 安装 Azure IoT Edge 运行时并连接设备</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%BA%94-%E8%A7%82%E5%AF%9F-enrollments-%E8%AE%BE%E5%A4%87%E7%8A%B6%E6%80%81"><strong>任务五: 观察 Enrollments 设备状态</strong></a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%9B%9B-%E9%83%A8%E7%BD%B2-iot-edge-%E6%A8%A1%E5%9D%97%E4%BB%A5%E6%A8%A1%E6%8B%9F%E8%AE%BE%E5%A4%87%E9%81%A5%E6%B5%8B"><strong>实验四: 部署 IoT Edge 模块以模拟设备遥测</strong></a>
<ul>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%B8%80-%E4%BD%BF%E7%94%A8-azure-iot-edge-%E6%A8%A1%E5%9D%97%E5%B8%82%E5%9C%BA%E6%8F%90%E4%BE%9B%E7%9A%84%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0%E6%A8%A1%E6%8B%9F%E6%B8%A9%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8"><strong>任务一: 使用 Azure IoT Edge 模块市场提供的模块实现模拟温度传感器</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%BA%8C-%E7%A1%AE%E4%BF%9D%E6%A8%A1%E5%9D%97%E6%AD%A3%E5%B8%B8%E5%9C%A8%E8%BF%90%E8%A1%8C"><strong>任务二: 确保模块正常在运行</strong></a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E4%BA%94%E4%BD%BF%E7%94%A8-iot-hub-%E5%92%8C-azure-data-explorer-%E6%8F%90%E5%8F%96%E9%81%A5%E6%B5%8B%E6%95%B0%E6%8D%AE-adx"><strong>实验五：使用 IoT Hub 和 Azure Data Explorer 提取遥测数据 (ADX)</strong></a>
<ul>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%B8%80-%E5%88%9B%E5%BB%BA-adx-%E9%9B%86%E7%BE%A4"><strong>任务一: 创建 ADX 集群</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%BA%8C-%E6%B7%BB%E5%8A%A0-adx-%E6%95%B0%E6%8D%AE%E5%BA%93"><strong>任务二: 添加 ADX 数据库</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%B8%89%E5%88%9B%E5%BB%BA%E6%B8%A9%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8%E8%A1%A8%E6%A0%BC"><strong>任务三：创建温度传感器表格</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E5%9B%9B-%E5%B0%86-adx-%E8%BF%9E%E6%8E%A5%E5%88%B0-iot-hub-%E4%BB%A5%E6%8F%90%E5%8F%96%E9%81%A5%E6%B5%8B%E6%95%B0%E6%8D%AE"><strong>任务四: 将 ADX 连接到 IoT Hub 以提取遥测数据</strong></a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%85%AD-%E7%94%A8-azure-data-explorer-adx-%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90"><strong>实验六: 用 Azure Data Explorer (ADX) 进行数据分析</strong></a>
<ul>
<li><a href="#%E4%BB%BB%E5%8A%A11-%E5%B0%86-asa-%E8%BF%9E%E6%8E%A5%E5%88%B0-iot-%E4%B8%AD%E5%BF%83"><strong>任务1: 将 ASA 连接到 IoT 中心</strong></a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E4%B8%83-%E4%BD%BF%E7%94%A8-azure-stream-analytics-asa-%E5%A4%84%E7%90%86%E9%81%A5%E6%B5%8B"><strong>实验七: 使用 Azure Stream Analytics (ASA) 处理遥测</strong></a>
<ul>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%B8%80-%E5%9C%A8-adx-%E4%B8%AD%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%A1%A8%E6%9D%A5%E4%BF%9D%E5%AD%98%E8%81%9A%E5%90%88%E6%95%B0%E6%8D%AE"><strong>任务一: 在 ADX 中创建一个表来保存聚合数据</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%BA%8C-%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84-asa-%E4%BD%9C%E4%B8%9A"><strong>任务二: 创建新的 ASA 作业</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%B8%89-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-asa-%E8%BE%93%E5%85%A5"><strong>任务三: 创建一个 ASA 输入</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E5%9B%9B-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-asa-%E8%BE%93%E5%87%BA"><strong>任务四: 创建一个 ASA 输出</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%BA%94-%E5%86%99%E5%85%A5-asa-%E6%9F%A5%E8%AF%A2"><strong>任务五: 写入 ASA 查询</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E5%85%AD-%E5%BC%80%E5%A7%8B%E8%B0%83%E5%BA%A6-asa-%E4%BB%BB%E5%8A%A1"><strong>任务六： 开始调度 ASA 任务</strong></a></li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E4%B8%83-%E6%9F%A5%E7%9C%8B-adx-%E4%B8%AD%E6%94%B6%E9%9B%86%E7%9A%84%E8%81%9A%E5%90%88"><strong>任务七: 查看 ADX 中收集的聚合</strong></a></li>
</ul>
</li>
<li><a href="#%E4%BB%BB%E5%8A%A1%E5%85%AB---%E6%B8%85%E7%A9%BA%E8%B5%84%E6%BA%90"><strong>任务八 - 清空资源</strong></a></li>
</ul>
</li>
</ul>
<!-- /code_chunk_output -->
<h2 id="%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><strong>准备工作</strong></h2>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%B8%80-%E5%AE%89%E8%A3%85-vs-code"><strong>任务一: 安装 VS Code</strong></h3>
<p><a href="https://code.visualstudio.com/Download">Visual Studio Code Download</a></p>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%BA%8C-%E5%AE%89%E8%A3%85-vs-code-%E7%9B%B8%E5%85%B3%E6%8F%92%E4%BB%B6"><strong>任务二: 安装 VS Code 相关插件</strong></h3>
<ol>
<li>点击插件按钮</li>
<li>查找 <code>azure iot</code></li>
<li>点击安装 <code>Azure IoT Tools</code> 插件包</li>
</ol>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-azure-iot-tools.png" alt="VS Code IoT Tools." title="VS Code IoT Tools"></p>
<h2 id="%E5%AE%9E%E9%AA%8C%E4%B8%80-%E8%AE%A4%E8%AF%86-azure-iot-%E4%B8%AD%E5%BF%83%E9%85%8D%E7%BD%AE%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9"><strong>实验一: 认识 Azure IoT 中心配置相关内容</strong></h2>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%B8%80-%E9%80%9A%E8%BF%87-azure-%E9%97%A8%E6%88%B7%E9%85%8D%E7%BD%AE-iot-%E4%B8%AD%E5%BF%83"><strong>任务一: 通过 Azure 门户配置 IoT 中心</strong></h3>
<p>在该任务中，您将使用三种不同的工具来创建三个不同的 IoT 中心，在该动手实验之后，我们将删除其中的两个并使用通过门户创建的第一个 IoT 中心继续动手实验的其余部分。</p>
<ol>
<li>
<p>In your browser, navigate to the <a href="https://portal.azure.com">Azure portal</a>, select <strong>+Create a resource</strong> in the navigation pane, enter <code>iot hub</code> into the <strong>Search the Marketplace</strong> box.</p>
</li>
<li>
<p>在浏览器中，导航到 <a href="https://portal.azure.com">Azure 门户</a>，在导航中选择 <strong>+创建资源 - +Create a resource</strong>，在 <strong>搜索框中输入<code>iot hub</code></strong> 可以在 Azure MarketPlace 上找到对应内容。</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/create-resource.png" alt="+Create a resource is shown on the Azure Portal home page." title="Create a resource"></p>
</li>
<li>
<p>从查找结果中选择 <strong>IoT Hub</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/create-resource-iot-hub.png" alt="+Create a resource is highlighted in the navigation page of the Azure portal, and &quot;iot&quot; is entered into the Search the Marketplace box. IoT Hub is highlighted in the search results." title="Create an IoT Hub"></p>
</li>
<li>
<p>选择创建 <strong>创建 - Create</strong>.</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/create-resource-iot-hub-button.png" alt="+The create button is now shown." title="Create button"></p>
</li>
<li>
<p>在 <strong>IoT Hub</strong> 的 <strong>Basics</strong> 选项卡上，输入以下内容：</p>
<ul>
<li>
<p><strong>订阅 - Subscription</strong>：选择用于此动手实验的订阅。</p>
</li>
<li>
<p><strong>资源组 - Resource group</strong>：单击资源组下的新建。 输入名称“rg-iot-academy”</p>
</li>
</ul>
<pre>
</pre>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/iot-hub-basics-blade-create-resource-group.png" alt="After clicking create new under resource group enter your new resource group name." title="Create IoT Hub New Resource Group"></p>
<ul>
<li>
<p><strong>IoT Hub Name - IoT Hub 名称</strong>：输入唯一名称，例如 <code>iot-academy-johndoe-220427</code>。
该名称遵循在 Azure 中命名资源的标准做法。
注意：</p>
<ol>
<li>
<p>前缀<code>iot-</code></p>
</li>
<li>
<p>包含名称“johndoe”和日期“220427(YYMMDD)”这种组合，例如“johndoe-220427”，将被称为您的<strong>后缀</strong>。 您可能会将其复制到记事本中，以便稍后复制和粘贴。</p>
</li>
</ol>
<p>由于 Azure 中的某些资源需要唯一名称，因此名称和日期有助于避免命名冲突。
可以在以下链接中阅读有关命名 Azure 资源的最佳实践的更多信息：<a href="https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/naming-and-tagging">Azure 命名和标记</a>
有关常见资源前缀的内容，请参阅以下链接：<a href="https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/resource-abbreviations">Azure Resource Abbreviations</a></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/iot-hub-basics-blade.png" alt="The Basics blade for IoT Hub is displayed, with the values specified above entered into the appropriate fields." title="Create IoT Hub Basic blade"></p>
</li>
<li>
<p><strong>区域 - Region</strong>：选择您用于此动手实验室的位置。</p>
</li>
<li>
<p>单击<strong>下一步：网络 - Next: Networking</strong>。</p>
</li>
<li>
<p>在 <strong>网络 - Networking</strong> 选项卡上，确保选择了“Public”</p>
</li>
<li>
<p>单击<strong>下一步：管理</strong>。</p>
</li>
<li>
<p>在<strong>管理</strong>选项卡上</p>
<ol>
<li><strong>定价和规模层 - Pricing and scale tier</strong>：确保选择“S1：标准层”</li>
<li><strong>S1 IoT 集线器单元的数量 - Number of S1 IoT hub units</strong>：确保选择“1”</li>
<li><strong>物联网防火墙 - Defender for IoT</strong>：设置为“开”</li>
<li><strong>将我分配给 IoT 中心数据参与者角色 - Assign me to the IoT Hub Data Contributor role</strong>：选中复选框</li>
<li><strong>设备到云分区 - Device-to-cloud partitions</strong>：保留默认设置 <code>4</code></li>
</ol>
</li>
<li>
<p>点击<strong>查看+创建</strong>。</p>
</li>
<li>
<p>确保验证通过并单击<strong>创建</strong>。</p>
</li>
</ul>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/iot-hub-create-details-management-1.png" alt="IoT Hub Create Details 1." title="IoT Hub Create Details 1">
<img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/iot-hub-create-details-management-2.png" alt="IoT Hub Create Details 2." title="IoT Hub Create Details 2"></p>
</li>
<li>
<p>单击创建后，您将被定向到部署概述的页面。 部署完成后，单击 <strong>进入资源组 - Go to resource</strong> 按钮。</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/iot-hub-create-complete.png" alt="Screenshot of the deployment overview." title="Deployment succeeded message"></p>
</li>
</ol>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%BA%8C-%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%85%8D%E7%BD%AE-iot-hub"><strong>任务二: 通过命令行配置 IoT Hub</strong></h3>
<ol>
<li>
<p>使用以下链接打开 Azure Cloud Shell</p>
<p>https://shell.azure.com/</p>
<p>如果您从未使用过 Azure 云</p>
<p>如果您以前从未使用过 Azure Cloud Shell：</p>
<ol>
<li>
<p>系统会提示你选择 Bash 或 Powershell，选择 <code>Bash</code></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/cloud-shell-1.png" alt="Cloud Shell Bash." title="Cloud Shell Bash"></p>
</li>
<li>
<p>系统将提示您安装存储帐户，单击 <strong>Create Storage</strong> 继续。 如果您之前使用过 Azure Cloud Shell，您将跳过此步骤。</p>
<ul>
<li>
<p>点击<strong>创建存储 - Create Storage</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/mount-storage.png" alt="Mount Storage Account." title="Mount Storage Account"></p>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p>如果尚未选择 <strong>Bash</strong> 请确认切换到 <strong>Bash</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/bash.png" alt="Bash access." title="Access Bash Link"></p>
</li>
<li>
<p>登录后，运行以下命令来创建 IoT 中心。</p>
<p>在以下命令中，将 <strong>iot-johndoe-cli-220427</strong> 替换为您的 iothub 名称，替换 johndoe 和适当的日期，形式为 iot-{yourname}-cli-{YYMMDD}</p>
<pre class="hljs"><code><div>az iot hub create --name iot-academy-johndoe-cli-220427 --resource-group rg-iot-academy --sku S1
</div></code></pre>
<p>当命令运行时，将会显示以下结果。</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/iot-hub-create-cli-running.png" alt="IoT Hub create running." title="IoT Hub create running"></p>
<p>当命令执行完成后，你将会看到</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/iot-hub-create-cli-complete.png" alt="IoT Hub create complete." title="IoT Hub create complete"></p>
</li>
<li>
<p>在浏览器选项卡中，进入到 <a href="https://portal.azure.com">Azure 门户</a> 以验证您新创建的 IoT 中心。</p>
<ol>
<li>在 Azure 门户主页单击导航部分下的<strong>所有资源 - All resources</strong>
<img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/portal-all-resources-iot-hub.png" alt="All Resources IoT Hub." title="All Resources IoT Hub"></li>
<li>验证您在资源列表中看到您已经创建的两个 IoT 中心
<img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/portal-all-resources-iot-hub-details.png" alt="All Resources IoT Hub." title="All Resources IoT Hub"></li>
</ol>
</li>
<li>
<p>使用 delete 命令删除刚刚创建的 IoT Hub。</p>
<ul>
<li>
<p>返回您的 Cloud Shell 选项卡</p>
</li>
<li>
<p>运行以下命令列出您的 IoT 中心</p>
<pre class="hljs"><code><div>az iot hub list -o table
</div></code></pre>
</li>
<li>
<p>在 Cloud Shell 中运行以下两个命令</p>
<p>再次，替换 johndoe 和适当的日期。 您还可以复制并粘贴上一个 <code>list</code> 命令中的名称</p>
<pre class="hljs"><code><div>az iot hub delete --name iot-johndoe-cli-220427 --resource-group rg-iot-academy
</div></code></pre>
<p>此外，删除通过门户创建的 IoT 中心</p>
<pre class="hljs"><code><div>az iot hub delete --name iot-academy-johndoe-220427 --resource-group rg-iot-academy   
</div></code></pre>
</li>
<li>
<p>再次运行 list 命令以确保您的 IoT Hub 实例已被删除</p>
<pre class="hljs"><code><div>az iot hub list -o table
</div></code></pre>
</li>
</ul>
</li>
</ol>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%B8%89-%E9%80%9A%E8%BF%87-vs-code-%E9%85%8D%E7%BD%AE-iot-hub"><strong>任务三: 通过 VS Code 配置 IoT Hub</strong></h3>
<p>如果您尚未安装 Visual Studio Code，请从以下链接下载并安装：
https://code.visualstudio.com/download</p>
<p>我们创建 Azure 资源 IoT 中心实例的第三种方法是使用 Visual Studio Code。</p>
<ol>
<li>
<p>通过以下两种方式之一安装 VS Code 的 IoT Tools 扩展包：</p>
<ul>
<li>
<p>使用以下网址
https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-tools</p>
</li>
<li>
<p>使用 VS Code 中的扩展选项卡（以红色突出显示），搜索 <strong>iot tools</strong>，选择<strong>Azure IoT Tools</strong>，点击<strong>Install</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-install-azure-iot-tools.png" alt="VS Code Install IoT Tools Extension Pack." title="VS Code Install IoT Tools Extension Pack"></p>
</li>
</ul>
</li>
<li>
<p>登录您的 Azure 帐户</p>
<ul>
<li>
<p>单击顶部工具栏上的 <strong>View</strong> 菜单，然后选择 <strong>Command Palette</strong>。</p>
</li>
<li>
<p>输入“azure sign”</p>
</li>
<li>
<p>单击“Azure: Sign in to Azure Cloud”命令</p>
</li>
<li>
<p>单击“Azure (Current)”（或按 Enter）</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-azure-sign-in.png" alt="Sign in." title="Sign in"></p>
</li>
<li>
<p>重定向到浏览器后选择您的帐户</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-azure-sign-in-pick-account.png" alt="Pick Account." title="Pick Account"></p>
</li>
<li>
<p>看到“您现在已登录并且可以关闭此页面 - You are signed in now and can close this page”后关闭浏览器选项卡。</p>
</li>
</ul>
</li>
<li>
<p>确保选择您的订阅</p>
<ul>
<li>打开 <strong>命令面板 - Command Palette</strong>（菜单或快捷方式）</li>
<li>输入“azure sub”并选择“Azure：选择订阅 - Azure: Select Subscriptions`”
<img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-select-subscription-search.png" alt="Select Subscriptions Search." title="Select Subscriptions Search"></li>
<li>为避免混淆，请确保您的订阅是否和此次动手实验期间订阅一致。
<img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-select-subscription-select.png" alt="Select Subscriptions Select." title="Select Subscriptions Select"></li>
</ul>
</li>
<li>
<p>单击查看菜单，然后单击资源管理器</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-view-explorer.png" alt="VS Code View Explorer." title="VS Code View Explorer"></p>
<ul>
<li>
<p>确保在 Explorer 视图中可以看到 <strong>Azure IoT Hub</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-view-explorer-iothub.png" alt="VS Code IoT Hub." title="VS Code IoT Hub"></p>
</li>
<li>
<p>创建新的 IoT Hub 转到顶部工具栏上的菜单 <strong>视图 - View</strong>，然后选择 <strong>命令面板 - Command Palette</strong>。</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-view-command-palette.png" alt="VS Code Command Palette." title="VS Code Command Palette"></p>
</li>
<li>
<p>在搜索栏中键入 <strong>Azure IoT Hub</strong>，然后您将通过可用命令列表选择 <strong>Azure IoT Hub: Create IoT Hub</strong> 并按回车。</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-command-iothub-create.png" alt="VS Code IoT Hub Create." title="IoT Hub Create"></p>
</li>
<li>
<p>设置如下参数:</p>
<ul>
<li><strong>订阅 - Subscription</strong>: 选择您的订阅</li>
<li><strong>资源组 - Resource group</strong>: 使用现有资源组，选择 <code>rg-iot-academy</code>。</li>
<li><strong>位置 - Location</strong>: 选择您在此动手实验室中用于资源的位置</li>
<li><strong>SKU</strong>: 选择 <strong>S1</strong>.</li>
<li><strong>名称 - Name</strong>: 使用您的姓名和日期 YYMMDD 为 IoTHub <code>iot-academy-johndoe-vscode-220427</code> 更改 <strong>johndoe</strong> 和 <strong>220427</strong> 分配一个名称。</li>
</ul>
<p>通过插件创建 IoT 中心实例时，您应该会看到如下状态消息。</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-iothub-creating.png" alt="VS Code IoT Hub Creating." title="IoT Hub Creating"></p>
</li>
<li>
<p>创建成功后，您应能在 VS Code 和 Azure 门户中看到通过 Visual Studio Code 插件创建的 IoT Hub。</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-iothub-created.png" alt="VS Code IoT Hub Created." title="VS Code IoT Hub Created"></p>
<p>Azure 门户资源组视图</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-azureportal-iothub-created.png" alt="Azure Portal IoT Hub Created." title="Azure Portal IoT Hub Created"></p>
</li>
</ul>
</li>
</ol>
<h2 id="%E5%AE%9E%E9%AA%8C%E4%BA%8C-azure-iot-hub-%E8%AE%BE%E5%A4%87%E9%A2%84%E9%85%8D%E6%9C%8D%E5%8A%A1-dps"><strong>实验二: Azure IoT Hub 设备预配服务 (DPS)</strong></h2>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%B8%80-%E9%83%A8%E7%BD%B2-dps"><strong>任务一: 部署 DPS</strong></h3>
<ol>
<li>
<p>通过以下方式创建 DPS 实例：</p>
<ul>
<li>转到 Azure 门户主页</li>
<li>点击<strong>创建资源 - reate a resource</strong></li>
<li>搜索 “device prov”</li>
<li>单击<strong>IoT Hub 设备配置服务 - IoT Hub Device Provisioning Service</strong></li>
</ul>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/dps-create.png" alt="Create DPS." title="Create DPS"></p>
</li>
<li>
<p>点击 <strong>创建 - Create</strong></p>
</li>
<li>
<p>创建详细信息</p>
<ul>
<li>输入以下详细信息
<ul>
<li>资源组 - Resource group：<code>rg-iot-academy</code></li>
<li>名称 - Name：<code>provs-iotacad-{SUFFIX}</code> 例如 <code>provs-iotacad-johndoe220427</code></li>
<li>地区 - Region：<code>你的地区</code></li>
</ul>
</li>
</ul>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/dps-create-details.png" alt="Create DPS." title="Create DPS"></p>
</li>
<li>
<p>点击 <strong>预览和创建 - Review and Create</strong>，然后点击 <strong>Create</strong></p>
</li>
<li>
<p>部署完成后，点击<strong>进入资源 - Go to resource</strong></p>
</li>
<li>
<p>加载概览页面时，将 <strong>ID Scope</strong> 保存到记事本</p>
</li>
</ol>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%BA%8C-%E9%93%BE%E6%8E%A5-iot-hub-%E5%88%B0-dps"><strong>任务二: 链接 IoT Hub 到 DPS</strong></h3>
<ol>
<li>
<p>选择 <strong>链接的物联网中心 - Linked IoT Hubs</strong>, 并点击 <strong>添加 - Add</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/dps-link-iothub.png" alt=""></p>
</li>
<li>
<p>填写以下详细信息，然后点击 <strong>保存 - Save</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/dps-link-iothub-details.png" alt=""></p>
</li>
<li>
<p>单击 <strong>管理分配策略 - Manage Allocation Policy</strong>，查看可用选项</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/dps-manage-allocation-policy.png" alt=""></p>
</li>
</ol>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%B8%89-%E5%88%9B%E5%BB%BA-individual-enrollment"><strong>任务三: 创建 Individual Enrollment</strong></h3>
<ol>
<li>
<p>选择 <strong>管理 enrollments -  Manage enrollments</strong></p>
</li>
<li>
<p>点击 <strong>添加 individual enrollment - Add individual enrollment</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/dps-manage-enrollments-add-individual.png" alt=""></p>
</li>
<li>
<p>填写以下详细信息</p>
<ul>
<li>机制：<code>Symmetric Key</code></li>
<li>自动生成密钥：<code>checked</code></li>
<li>注册 ID：<code>iotacademy</code></li>
<li>IoT 中心设备 ID：<code>iot-academy-edge-device</code></li>
<li>IoT Edge 设备：“真”</li>
<li>选择此设备可以分配到的 IoT 中心：<code>select your hub</code></li>
<li>将所有其他值保留为默认值</li>
</ul>
</li>
<li>
<p>在页面顶部点击 <strong>保存 - Save</strong></p>
</li>
</ol>
<h3 id="%E4%BB%BB%E5%8A%A1%E5%9B%9B%E6%94%B6%E9%9B%86-individual-enrollment-%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><strong>任务四：收集 Individual Enrollment 详细信息</strong></h3>
<ol>
<li>选择<strong>管理注册 - Manage enrollments</strong>，然后单击<strong>Individual Enrollments</strong>，然后选择您的注册<strong>iotacademy</strong>
<img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/dps-individual-enrollment-view.png" alt="View Enrollment." title="View Enrollment"></li>
<li>在记事本中记下以下值
<ul>
<li>注册 ID：<code>iotacademy</code></li>
<li>IoT Hub ID：<code>iot-academy-edge-device</code></li>
<li>主键（单击下图所示的复制图标）
<img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/dps-individual-enrollment-view-details.png" alt="View Enrollment Details." title="View Enrollment Details"></li>
</ul>
</li>
</ol>
<h2 id="%E5%AE%9E%E9%AA%8C%E4%B8%89%E5%88%9B%E5%BB%BA%E5%9F%BA%E4%BA%8E-ubuntu-%E7%9A%84-azure-iot-edge-%E8%AE%BE%E5%A4%87"><strong>实验三：创建基于 Ubuntu 的 Azure IoT Edge 设备</strong></h2>
<p>在本练习中，您将学习如何设置 Azure IoT Edge 设备并将其连接到 IoT 中心以开始流式传输数据。</p>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%B8%80-%E7%A1%AE%E4%BF%9D-azure-resource-provider-%E5%B7%B2%E7%BB%8F%E6%B3%A8%E5%86%8C"><strong>任务一: 确保 Azure Resource Provider 已经注册</strong></h3>
<ol>
<li>返回到 Azure Cloud Shell 的浏览器的选项卡中，或打开 https://shell.azure.com</li>
<li>执行以下命令<pre class="hljs"><code><div>az provider show -n Microsoft.Compute -o table
</div></code></pre>
<img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/cloud-shell-resource-provider-not-registered.png" alt=""></li>
<li>如果状态为 “已注册 - Registered”，请继续执行任务二</li>
<li>如果状态为 “未注册 - NotRegistered”, 执行以下命令注册 Resource Provider<pre class="hljs"><code><div>az provider register -n <span class="hljs-string">'Microsoft.Compute'</span> --<span class="hljs-built_in">wait</span> -o table
</div></code></pre>
<img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/cloud-shell-resource-provider-not-registered.p" alt=""></li>
</ol>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%BA%8C-%E5%88%9B%E5%BB%BA-vm-%E4%BB%A5%E6%89%98%E7%AE%A1-iot-edge-%E8%AE%BE%E5%A4%87"><strong>任务二: 创建 VM 以托管 IoT Edge 设备</strong></h3>
<p>在该任务中，我们将使用基于 Ubuntu 的 VM 设置 IoT Edge 设备。</p>
<ol>
<li>
<p>从 Azure 门户中选择<strong>Create resource - 创建资源</strong>，然后从列表中选择<strong>Ubuntu Server 18.04 LTS</strong>。 如果您没有看到它，请使用标题为 <strong>查找服务和市场应用 - Search services and marketplace</strong> 的搜索框来搜索 <strong>Ubuntu Server 18.04 LTS</strong>。</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/edge-device-create-ubuntu-vm.png" alt="Portal Create Ubuntu VM." title="Create Ubuntu VM">
<br/></p>
</li>
<li>
<p>然后您将需要在 <strong>Basics</strong> 选项卡中完成以下参数设置:</p>
<span style="color:rgb(203,65,84);font-weight:700;font-size:20px">  
</span><p>注意：对于下面的 <code>区域 - Region</code> 和 <code>大小 - Size</code> 选项。在撰写本文时，各个 Azure 区域的新订阅都缺少许多 VM 大小。</p>
<p>可用的 VM SKU 基于您在其中创建 VM 资源的区域或位置。</p>
<p>对于“位置 - Location”，您可能需要查看您所在区域之外的其他资源。在撰写内容时，“瑞典中心”似乎有许多可用的 VM SKU 并用于此演示。</p>
<p>让您的资源分布在不同的区域并不理想，因为它会因网络使用而产生额外的成本。由于此演示的规模和范围很小，它不会对成本产生有意义的影响。</p>
<p>对于“大小 - Size”，请查找成本低于 40 美元/月的 VM sku。</p>
<p>建议使用用 Azure 信用额度 - “B1s”，其中包括免费时间，而且价格也低于 8 美元/月</p>

<ul>
<li><strong>订阅 - Subscription</strong>：选择您用于此动手实验的订阅。</li>
<li><strong>资源组 - Resource group</strong>：使用现有并选择您的资源组，<code>rg-iot-academy</code>。</li>
<li><strong>虚拟机名称 - Virtual Machine Name</strong>：输入 edgedevice+后序 例如<code>edgedevice-johndoe-220427</code></li>
<li><strong>区域 - Region</strong>：参考<span style="color:rgb(203,65,84)">注意提及的</span></li>
<li><strong>可用性选项 - Availability Options</strong>：选择“不需要基础设施冗余”。</li>
<li><strong>镜像 - Image</strong>：保持默认</li>
<li><strong>尺寸 - Size</strong>：参考<span style="color:rgb(203,65,84)">注意</span></li>
<li><strong>身份验证类型 -Authentication Type</strong>：选择“密码”</li>
<li><strong>用户名 - Username</strong>：<code>iotacademy</code></li>
<li><strong>密码 - Password</strong>：<code>MSFTacademy01!</code>（为了更高的安全性，您可以创建自己的强密码）</li>
<li><strong>公共入站端口 - Public inbound ports</strong>：<code>无</code></li>
</ul>
</li>
</ol>
<br>
<ol start="3">
<li>
<p>单击窗格顶部的 <strong>管理 - Management</strong> 选项卡。
<img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/edge-device-create-ubuntu-vm-management.png" alt="Create VM Management Tab." title="Create VM Management Tab"></p>
<p>注意自动关机功能。 此功能有助于控制开发或不经常使用的虚拟机的成本。 当 VM 关闭时，您不会产生计算成本。
<img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/edge-device-create-ubuntu-vm-management2.png" alt="Management tab Auto-shutdown feature." title="Management tab Auto-shutdown feature">
<br/></p>
</li>
<li>
<p>单击标签选项卡
添加以下两个标签</p>
</li>
</ol>
<ul>
<li>
<p>环境 - environment：development</p>
</li>
<li>
<p>产品 - product：物联网学院培训</p>
 <br>
 &#x521B;&#x5EFA; VM &#x65F6;&#x663E;&#x793A;&#x6807;&#x7B7E;&#x9009;&#x9879;&#x5361;&#x7684;&#x56FE;&#x8868;
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/edge-device-create-ubuntu-vm-tags.png" alt="Set tags." title="Set tags"></p>
 <br>
<p>标签是 Azure 资源管理、治理的一个重要方面。 在成熟的组织中拥有成千上万的资源并不少见。 这些标签可用于搜索、报告和自动化工具，以简化大型部署的管理。
你可以阅读 <a href="https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/resource-tagging">Azure Tagging Strategy</a></p>
</li>
</ul>
<br>
<ol start="5">
<li>
<p>最后选择 <strong>检查+创建 - Review + Create</strong> 验证成功后应该可以点击<strong>创建 - Create</strong>
<br/></p>
</li>
<li>
<p>一旦资源可用，请单击 <strong>进入资源 - Go to resource</strong> 以查看新创建的虚拟机。 您应该在浏览部分看到要连接的公共 IP，请将 IP 复制到记事本。</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/edge-device-ubuntu-vm-ip-address.png" alt="Virtual Machine IP." title="Virtual Machine IP"></p>
</li>
</ol>
<br>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%B8%89-%E9%93%BE%E6%8E%A5%E5%88%9B%E5%BB%BA%E5%A5%BD%E7%9A%84-unbuntu-%E8%99%9A%E6%8B%9F%E6%9C%BA"><strong>任务三: 链接创建好的 Unbuntu 虚拟机</strong></h3>
<p>构建云基础设施的一个重要方面是以安全为前提条件。</p>
<p>作为此任务的一部分，可以为 SSH 打开端口 22，以允许快速连接到 VM。 但是，这可能让黑客尝试破坏此端口。</p>
<p>可以使用两种更安全的方法</p>
<pre><code>- 更安全的方法是使用 Azure 虚拟机的一项重要功能，Just-in-time  (JIT) VM 访问。 此功能允许在指定的时间内启用对 VM 的访问。 更多信息可以在 [Just-in-time VM Access](https://docs.microsoft.com/en-us/azure/defender-for-cloud/just-in-time-access-usage) 中找到
- 启用 SSH，端口 22，仅访问您的 IP 地址
</code></pre>
<p>为简单起见，将使用第二个选项。
<br/></p>
<ol>
<li>
<p>在浏览器中转到 <a href="https://www.bing.com">www.bing.com</a> 并搜索“what is my ip”</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/ubuntu-vm-networking-find-my-ip.png" alt="What is my IP?" title="What is my IP?">
<br/>
在笔记本中复制该 IP
<br/></p>
</li>
<li>
<p>在您的 VM 资源上，单击 <strong>网络 - Networking</strong> 选项卡。 点击<code>添加入站端口规则 - Add inbound port rule</code></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/ubuntu-vm-networking-add-inbound-port-rule.png" alt="VM add inbound rule." title="VM add inbound rule"></p>
</li>
</ol>
<br>
<ol start="4">
<li>
<p>设置新入站端口规则的详细信息，单击添加。</p>
<ul>
<li>来源 - Source：<code>IP 地址</code></li>
<li>源 IP 地址/CIDR 范围 - Source IP addresses/CIDR ranges：<code>您保存在记事本中的 IP 地址</code></li>
<li>源端口范围 - Source port ranges：<code>*</code></li>
<li>服务 - Service：<code>SSH</code></li>
<li>行动 - Action：<code>允许</code></li>
<li>优先级 - Priority：<code>100</code></li>
<li>名称 - Name：<code>Port_22</code></li>
</ul>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/ubuntu-vm-networking-add-inbound-port-rule-details.png" alt="VM add inbound rule details." title="VM add inbound rule details"></p>
</li>
</ol>
<br>
<ol start="5">
<li>
<p>观察安全规则创建成功的通知</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/ubuntu-vm-networking-add-inbound-port-rule-completed-notification.png" alt="VM add inbound rule completed notification." title="VM add inbound rule completed notification"></p>
</li>
</ol>
<br>
<ol start="6">
<li>
<p>切换到 VS Code，使用 <strong>视图 - View</strong> 菜单并单击 <strong>终端 - Terminal</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-view-terminal.png" alt="VS Code View Terminal." title="VS Code View Terminal"></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-terminal-bash.png" alt="VS Code Terminal." title="VS Code Terminal"></p>
<p>If you don't see a <code>bash</code> terminal at the top, click the <code>+</code> and click <code>bash</code>
<br/></p>
</li>
<li>
<p>输入<code>ssh iotacademy@{你的VM的公共IP地址}</code>然后回车。 您之前在记事本中保存了 VM 的公共 IP 地址。 确保不要将您的公共 IP 地址与 VM 的 IP 地址混淆。
例如 <code>ssh iotacademy@20.122.53.2</code></p>
</li>
</ol>
<br>
<p>如果这是您第一次连接，您会看到一个提示，询问“您确定要继续连接吗？ - Are you sure you want to continue connecting?”。 输入“是 - yes”，然后按 Enter。</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-terminal-fingerprint-yes.png" alt="VS Code Terminal Continue Connecting." title="VS Code Terminal Continue Connecting"></p>
<br>
<ol start="8">
<li>
<p>输入您之前定义的密码“MSFTacademy01！”，然后按 Enter。 可以通过以下方式将密码复制到剪贴板并粘贴到终端中：</p>
<ul>
<li>左键单击终端窗口一次，聚焦窗口</li>
<li>右键单击终端窗口一次，这将粘贴剪贴板内容
<br/></li>
</ul>
<p>成功连接后，您将在终端中看到以下内容</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/vscode-terminal-connected.png" alt="VS Code Terminal Connected." title="VS Code Terminal Connected">
<br/></p>
</li>
</ol>
<h3 id="%E4%BB%BB%E5%8A%A1%E5%9B%9B-%E5%AE%89%E8%A3%85-azure-iot-edge-%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B9%B6%E8%BF%9E%E6%8E%A5%E8%AE%BE%E5%A4%87"><strong>任务四: 安装 Azure IoT Edge 运行时并连接设备</strong></h3>
<ol>
<li>
<p>现在登录到 VM，安装 Edge Runtime</p>
<p>安装与您的设备操作系统匹配的存储库配置</p>
<pre class="hljs"><code><div>curl https://packages.microsoft.com/config/ubuntu/18.04/multiarch/prod.list &gt; ./microsoft-prod.list
</div></code></pre>
<p>将生成的列表复制到 sources.list.d 目录</p>
<pre class="hljs"><code><div>sudo cp ./microsoft-prod.list /etc/apt/sources.list.d/
</div></code></pre>
<p>安装 Microsoft GPG 公钥</p>
<pre class="hljs"><code><div>curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor &gt; microsoft.gpg
sudo cp ./microsoft.gpg /etc/apt/trusted.gpg.d/
</div></code></pre>
<p>Azure IoT Edge 软件包受每个软件包（usr/share/doc/{package-name} 或 LICENSE 目录）中的许可条款的约束。 在使用软件包之前阅读许可条款。 您安装和使用软件包即表示您接受这些条款。 如果您不同意许可条款，请不要使用该软件包。</p>
<p>成功运行前面的命令后，您将看到图中所示的以下结果。</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/ssh-configure-add-package-sources-complete.png" alt="Package sources complete" title="Package sources complete"></p>
</li>
<li>
<p>安装容器引擎</p>
<p>更新设备上的软件包列表.</p>
<pre class="hljs"><code><div>   sudo apt-get update
</div></code></pre>
<p>安装 Moby 引擎</p>
<pre class="hljs"><code><div>   sudo apt-get install moby-engine
</div></code></pre>
</li>
<li>
<p>安装 IoT Edge Runtime 包</p>
<pre class="hljs"><code><div>   sudo apt-get install iotedge
</div></code></pre>
</li>
<li>
<p>编辑 IoT Edge config.yaml，更新预配信息</p>
<ul>
<li>使用我们在设置 DPS 期间保存的信息配置部分。</li>
</ul>
<pre class="hljs"><code><div>   sudo nano /etc/iotedge/config.yaml
</div></code></pre>
<ul>
<li>向下滚动到 <strong>使用手动配置 IoT 中心连接字符串 - Manual Provisioning with an IoT Hub connection string</strong> 然后使用 <code>#</code> 符号注释掉所有未注释的行。 您可能必须使用箭头键在 Nano 中导航.</li>
</ul>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/ssh-edit-iot-edge-connectionstring.png" alt="Config File." title="Config File"></p>
<ul>
<li>向下滚动以找到 <strong>使用对称密钥的 DPS 配置 - DPS provisioning with symmetric key attestation</strong> 部分。 取消注释部分并设置以下值。 注意：重要的是使用缩进。 使用模板文件时，需要从每一行中删除 <code>#</code> 和空格。
<ul>
<li>scope_id：在记事本中保存过（例如 <code>0ne115AEAFD</code>）</li>
<li>registration_id：<code>iotacademy</code>已经保存在记事本中</li>
<li>symmetric_key：记事本中保存过的主键</li>
</ul>
</li>
</ul>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/ssh-edit-iot-edge-dps-provisioning.png" alt="Config File." title="Config File"></p>
<p>进行编辑后：
- 按 <strong>CrtL+X</strong> 关闭文件
- 选择 <strong>Y</strong> 保存更改
- 按 Enter 接受文件名</p>
<p>现在重新启动您的边缘程序</p>
<pre class="hljs"><code><div>   sudo systemctl restart iotedge
</div></code></pre>
<p>在执行以下命令后，应该会在几分钟内接收到 <strong>运行中 - Running</strong> 状态。</p>
<span style="color:rgb(203,65,84);font-weight:700;font-size:20px">    
   &#x5982;&#x679C;&#x91CD;&#x65B0;&#x542F;&#x52A8; IoT Edge Runtime &#x540E;&#x6CA1;&#x6709;&#x7ECF;&#x8FC7;&#x8DB3;&#x591F;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x5219;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x8FD0;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x591A;&#x6B21;&#x3002;
</span><pre><code>定期重新运行命令，设置最多 10 分钟。
</code></pre>

<pre class="hljs"><code><div>   sudo iotedge list
</div></code></pre>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/iot-edge-runtime-edge-agent-running.png" alt=""></p>
<p>另一个有用的命令是 <strong>检查 - check</strong>，如下所示。 <strong>检查 - check</strong>命令：
- 检查 config.yaml 文件的有效性
- 容器引擎功能是否正常
- 时间是否正确的
- 是否建立到 DPS 和 IoT Hub 的连接</p>
<pre class="hljs"><code><div>   sudo iotedge check
</div></code></pre>
<p>出现一些 <span style="color:yellow;background-color:black">警告</span> 和 <span style="color:red;background-color:black">错误</span>是正常的</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/iot-edge-runtime-edge-agent-check.png" alt=""></p>
</li>
</ol>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%BA%94-%E8%A7%82%E5%AF%9F-enrollments-%E8%AE%BE%E5%A4%87%E7%8A%B6%E6%80%81"><strong>任务五: 观察 Enrollments 设备状态</strong></h3>
<ol>
<li>返回 Azure 门户主页</li>
<li>通过搜索“provs”并单击您的实例，导航到您的 DPS 实例。</li>
<li>点击<strong>管理 Enrollments - Manage Enrollments</strong></li>
<li>点击<strong>个人 Enrollments  - Individual Enrollments</strong></li>
<li>点击<strong>iotacademy</strong></li>
</ol>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/dps-registration-status-assigned.png" alt="Config File." title="Config File"></p>
<h2 id="%E5%AE%9E%E9%AA%8C%E5%9B%9B-%E9%83%A8%E7%BD%B2-iot-edge-%E6%A8%A1%E5%9D%97%E4%BB%A5%E6%A8%A1%E6%8B%9F%E8%AE%BE%E5%A4%87%E9%81%A5%E6%B5%8B"><strong>实验四: 部署 IoT Edge 模块以模拟设备遥测</strong></h2>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%B8%80-%E4%BD%BF%E7%94%A8-azure-iot-edge-%E6%A8%A1%E5%9D%97%E5%B8%82%E5%9C%BA%E6%8F%90%E4%BE%9B%E7%9A%84%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0%E6%A8%A1%E6%8B%9F%E6%B8%A9%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8"><strong>任务一: 使用 Azure IoT Edge 模块市场提供的模块实现模拟温度传感器</strong></h3>
<ol>
<li>
<p>在 Azure 门户中，导航到在前面步骤中创建的 IoT Hub，在 <strong>设备管理 - Device Management</strong> 下单击 <strong>IoT Edge</strong>，然后单击 Edge Device</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/edge-set-module-1.png" alt="Select Device." title="Select Device"></p>
</li>
<li>
<p>选择 <strong>设置模块 - Set Modules</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/edge-set-module-2.png" alt="Set Modules." title="Set Modules"></p>
</li>
<li>
<p>点击 <strong>添加 - Add</strong>. 再点击 <strong>市场模块 - Marketplace Module</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/edge-set-module-add-module.png" alt="Add Module." title="Add Module"></p>
</li>
<li>
<p>在出现的搜索框中输入<strong>Simulated Temperature Sensor</strong>，然后点击添加模块</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/edge-set-module-add-module-simulated-temp.png" alt="添加临时模块。" title="添加临时模块"></p>
</li>
<li>
<p>查看演示部分 <strong>Routes</strong> 以了解 IoT Edge 路由</p>
</li>
<li>
<p>单击窗格底部的 <strong>预览 + 创建 - Review + create</strong>。 查看部署的可用设置</p>
</li>
<li>
<p>验证通过后，单击窗格底部的<strong>创建</strong></p>
</li>
</ol>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%BA%8C-%E7%A1%AE%E4%BF%9D%E6%A8%A1%E5%9D%97%E6%AD%A3%E5%B8%B8%E5%9C%A8%E8%BF%90%E8%A1%8C"><strong>任务二: 确保模块正常在运行</strong></h3>
<p>查看 Edge 设备上正在运行的模块</p>
<pre><code>模块部署并进入运行状态可能需要几分钟。
可以通过以下几种方式验证正在运行的模块：

- 在设备详细信息中查看窗格底部的 **Modules** 部分

  ![Edge Modules.](./media/edge-set-module-module-running.png 'Modules')

  The **Refresh** button can also be used to get the latest status rather than refreshing the page. 
</code></pre>
<ul>
<li>使用 SSH，连接到您的 VM 并运行 <code>iotedge list</code> 命令，如下<pre class="hljs"><code><div>sudo iotedge list
</div></code></pre>
<img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/edge-set-module-module-running-ssh.png" alt="Edge Modules." title="Modules Running"></li>
</ul>
<h2 id="%E5%AE%9E%E9%AA%8C%E4%BA%94%E4%BD%BF%E7%94%A8-iot-hub-%E5%92%8C-azure-data-explorer-%E6%8F%90%E5%8F%96%E9%81%A5%E6%B5%8B%E6%95%B0%E6%8D%AE-adx"><strong>实验五：使用 IoT Hub 和 Azure Data Explorer 提取遥测数据 (ADX)</strong></h2>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%B8%80-%E5%88%9B%E5%BB%BA-adx-%E9%9B%86%E7%BE%A4"><strong>任务一: 创建 ADX 集群</strong></h3>
<ol>
<li>
<p>查找 Azure Data Explorer service 去创建集群</p>
<ul>
<li>
<p>通过选择窗口顶部的 <strong>Microsoft Azure</strong> 转到 Azure 门户主页。 然后单击 <strong>Azure 数据资源管理器集群 - Azure Data Explorer Clusters</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/telemetry-data-adx-search.png" alt="ADX Search." title="ADX Search"></p>
</li>
<li>
<p>点击 <strong>Create - 创建</strong>
<br/></p>
</li>
</ul>
</li>
<li>
<p>输入新 ADX 集群的相关信息，然后单击 <strong>预览 + 创建 - Review + create</strong></p>
<ul>
<li>
<p>详细内容</p>
<ul>
<li>资源组 - Resource group：<code>rg-iot-academy</code></li>
<li>集群名称 - Cluster name：<code>{prefix|iot|acad|johnd|220427}</code> 例如 <code>deciotacadjohnd220427</code>。 此名称必须是全球唯一的，仅限字母数字，最多 22 个字符。</li>
<li>地区 - Region：<code>{您的地区}</code> 例如 <code>美国东部2</code></li>
<li>工作负载 - Workload：<code>Dev/test</code></li>
<li>计算规范 - Compute specifications：<code>Dev(No SLA)_Standard_E2a_v4</code></li>
<li>可用区 - vailability Zones：取消选中所有选项。 可用区提供弹性，通常用于生产系统。
<br/></li>
</ul>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/telemetry-data-adx-create.png" alt="Add Create ADX." title="Add Create ADX"></p>
</li>
<li>
<p>验证通过后点击 <strong>创建 - Create</strong></p>
</li>
<li>
<p>等待集群创建完成，这可能需要大约 5-10 分钟，然后单击 <strong>进入资源组 - Go to resource</strong>
<br/></p>
</li>
</ul>
</li>
</ol>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%BA%8C-%E6%B7%BB%E5%8A%A0-adx-%E6%95%B0%E6%8D%AE%E5%BA%93"><strong>任务二: 添加 ADX 数据库</strong></h3>
<ol>
<li>
<p>现在在新 ADX 集群的概览选项卡上单击 <strong>添加数据库 - Add database</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/telemetry-data-adx-add-db.png" alt="Add ADX Database." title="Add ADX Database">
<br/></p>
</li>
<li>
<p>点击 <strong>创建 - Create</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/telemetry-data-adx-add-db-details.png" alt="Add ADX Database Details." title="Add ADX Database Details"></p>
<ul>
<li>片刻之后，您将返回概览页面。
<br/></li>
</ul>
</li>
</ol>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%B8%89%E5%88%9B%E5%BB%BA%E6%B8%A9%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8%E8%A1%A8%E6%A0%BC"><strong>任务三：创建温度传感器表格</strong></h3>
<p>使用结构和映射创建温度传感器表</p>
<ul>
<li>
<p>选择 <strong>查询 - Query</strong>。 单击您的 <strong>温度传感 -tempsensor</strong> 数据库。 将下面的创建表代码粘贴到窗口中。 然后点击<strong>运行 - Run</strong>。</p>
 <span style="color:rgb(203,65,84);font-weight:700;font-size:16px">          
 &#x6CE8;&#x610F;&#xFF1A;&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x5982;&#x679C;&#x662F;&#x7070;&#x8272;&#x7684;&#xFF0C;&#x8BF7;&#x5237;&#x65B0;&#x60A8;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x9875;&#x9762;&#x3002;
 </span>
<pre class="hljs"><code><div>.create table tempsensor (timeCreated: datetime, temperature: real, humidity: real)
</div></code></pre>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/telemetry-data-adx-create-table.png" alt="ADX Create Table." title="ADX Create Table"></p>
</li>
<li>
<p>创建成功后会收到如下信息</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/telemetry-data-adx-create-table-complete.png" alt="ADX Create Table." title="ADX Create Table"></p>
</li>
<li>
<p>接下来，创建温度传感器摄取映射。 将窗口中的命令替换为以下代码块中的命令。 然后，单击<strong>运行 -Run</strong>。
成功后，将观察到来自上一个命令的类似结果。</p>
<pre class="hljs"><code><div>.create table tempsensor ingestion json mapping 'tempsensorMapping' '[{&quot;column&quot;:&quot;timeCreated&quot;,&quot;path&quot;:&quot;$.timeCreated&quot;,&quot;datatype&quot;:&quot;datetime&quot;},{&quot;column&quot;:&quot;humidity&quot;,&quot;path&quot;:&quot;$.ambient.humidity&quot;,&quot;datatype&quot;:&quot;real&quot;},{&quot;column&quot;:&quot;temperature&quot;,&quot;path&quot;:&quot;$.ambient.temperature&quot;,&quot;datatype&quot;:&quot;real&quot;}]'
</div></code></pre>
</li>
</ul>
<br>
<h3 id="%E4%BB%BB%E5%8A%A1%E5%9B%9B-%E5%B0%86-adx-%E8%BF%9E%E6%8E%A5%E5%88%B0-iot-hub-%E4%BB%A5%E6%8F%90%E5%8F%96%E9%81%A5%E6%B5%8B%E6%95%B0%E6%8D%AE"><strong>任务四: 将 ADX 连接到 IoT Hub 以提取遥测数据</strong></h3>
<ol>
<li>
<p>将新的消费者组添加到您的 IoT 中心</p>
<ul>
<li>
<p>使用 Azure 门户搜索栏，输入“vscode”。 将显示您的 IoT 中心实例。 单击您的 IoT 中心名称以导航到该资源。</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/telemetry-data-iothub-search.png" alt="IoT Hub Search." title="IoT Hub Search"></p>
</li>
<li>
<p>单击<strong>内置端点 - Built-in endpoints</strong>。 在 <strong>消费者组 - Consumer Groups</strong> 部分下添加一个新的消费者组。 在框中键入“adx”，然后按 Tab保存您的输入。</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/telemetry-data-iothub-create-consumer-group.png" alt="Create Consumer Group." title="Create Consumer Group"></p>
</li>
</ul>
</li>
<li>
<p>创建数据连接以获取温度传感器的遥测数据</p>
<ul>
<li>
<p>使用 Azure 门户搜索栏搜索“dec”，这是 Azure Data Explorer 资源的标准前缀。 然后，单击您的实例以加载资源。</p>
</li>
<li>
<p>单击<strong>创建数据连接 - Create data connection</strong>，然后选择 IoT 中心</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/telemetry-data-adx-ingest-create-connection.png" alt="ADX Create Connection." title="ADX Create Connection"></p>
</li>
<li>
<p>填写以下所有字段：</p>
<ul>
<li>数据连接名称 - Data connection name ：<code>tempsensor</code></li>
<li>订阅 - Subscription：{您的订阅}</li>
<li>IoT 中心 - IoT Hub：{名称中包含 vscode 的 IoT 中心}</li>
<li>共享访问策略 - Shared Access Policy：{iothubowner}</li>
<li>消费者组 - Consumer Group：<code>adx</code></li>
<li>事件系统属性 - Event system properites：单击下拉菜单并选择“iothub-connection-device-id”</li>
<li>数据库名称 - Database Name：<code>tempsensor</code></li>
<li>表名 - Table name：<code>tempsensor</code></li>
<li>数据格式 - Data format：<code>JSON</code></li>
<li>映射名称 - Mapping name：<code>tempsensorMapping</code></li>
</ul>
</li>
<li>
<p>点击 <strong>创建 - Create</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/telemetry-data-adx-ingest-create-connection-details.png" alt="ADX Create Connection Details." title="ADX Create Connection Details"></p>
</li>
<li>
<p>查看数据连接创建成功时的通知。</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/telemetry-data-adx-ingest-create-connection-notification.png" alt="ADX Create Connection Notification." title="ADX Create Connection Notification"></p>
</li>
</ul>
</li>
</ol>
<h2 id="%E5%AE%9E%E9%AA%8C%E5%85%AD-%E7%94%A8-azure-data-explorer-adx-%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90"><strong>实验六: 用 Azure Data Explorer (ADX) 进行数据分析</strong></h2>
<h3 id="%E4%BB%BB%E5%8A%A11-%E5%B0%86-asa-%E8%BF%9E%E6%8E%A5%E5%88%B0-iot-%E4%B8%AD%E5%BF%83"><strong>任务1: 将 ASA 连接到 IoT 中心</strong></h3>
<ol>
<li>
<p>重新启动温度传感器模块以确保新的遥测数据正在流动</p>
<p>“模拟温度传感器 - Simulated Temperature Sensor”模块每 5 秒发送 500 条遥测消息。 这个过程需要大约 40 分钟的消息。 由于我们动手实验需要一些时间来完成，我们将重新启动模块以确保我们有大量数据可以通过 ADX 进行分析。</p>
<ul>
<li>
<p>创建第二个浏览器选项卡以在 Azure 门户中打开 ADX 和 IoT 中心。 右键单击浏览器选项卡，然后单击<strong>复制选项卡 - Duplicate tab</strong>。</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/edge-duplicate-tab.png" alt="Edge Duplicate Tab." title="Edge Duplicate Tab">
<br/></p>
</li>
<li>
<p>切换到您的第二个选项卡，然后单击窗口顶部的 Microsoft Azure 将您带到主页。</p>
</li>
<li>
<p>在资源中单击您的 IoT Hub 实例，例如“iot-academy-johndoe-vscode-220427”</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/recent-resources-iothub.png" alt="Recent Resources." title="Recent Resources">
<br/></p>
</li>
<li>
<p>选择 <strong>IoT Edge</strong>, 点击你的设备 <strong>iot-academy-edge-device</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/iot-hub-iot-edge-device.png" alt="IoT Hub Edge Device." title="IoT Hub Edge Device">
<br/></p>
</li>
<li>
<p>点击窗口底部的 <strong>模拟温度传感器 - Simulated Temperature Sensor</strong> 模块</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/iot-hub-device-module.png" alt="IoT Hub Device Module." title="IoT Hub Device Module">
<br/></p>
</li>
<li>
<p>点击窗口顶部的 <strong>疑难解答 -Troubleshoot</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/iot-hub-edge-module-troubleshoot.png" alt="Troubleshoot." title="Troubleshoot">
<br/></p>
</li>
<li>
<p>单击 <strong>重新启动模拟温度传感器 - Restart Simulated Temperature Sensor</strong>
请注意收到的状态“初始化模拟温度传感器以每5秒发送 500 条消息”</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/simulated-temp-sensor-restart.png" alt="Restart Simulated Temperature Sensor." title="Restart Simulated Temperature Sensor">
<br/></p>
</li>
</ul>
</li>
<li>
<p>查看 ADX 收到的数据</p>
<ul>
<li>单击仍然加载 ADX 的第一个浏览器选项卡。</li>
<li>选择 <strong>查询</strong>并输入以下查询。 此外，点击击<code>&gt;&gt;</code> 并确保选择了<code>tempsensor</code> 数据库范围。<pre class="hljs"><code><div>tempsensor
| order by timeCreated desc 
| limit  10
</div></code></pre>
<img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/adx-query-tempsensor-recent.png" alt="Query Temp Sensor Data." title="Query Temp Sensor Data">
<br/></li>
<li>单击<strong>运行 - Run</strong>按钮。 如果您习惯使用 SQL，请不要按 F5，因为它会刷新您的浏览器。
<img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/adx-query-tempsensor-recent-data.png" alt="Recent Temp Sensor Data." title="Recent Temp Sensor Data">
<br/></li>
</ul>
</li>
</ol>
<h2 id="%E5%AE%9E%E9%AA%8C%E4%B8%83-%E4%BD%BF%E7%94%A8-azure-stream-analytics-asa-%E5%A4%84%E7%90%86%E9%81%A5%E6%B5%8B"><strong>实验七: 使用 Azure Stream Analytics (ASA) 处理遥测</strong></h2>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%B8%80-%E5%9C%A8-adx-%E4%B8%AD%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%A1%A8%E6%9D%A5%E4%BF%9D%E5%AD%98%E8%81%9A%E5%90%88%E6%95%B0%E6%8D%AE"><strong>任务一: 在 ADX 中创建一个表来保存聚合数据</strong></h3>
<ul>
<li>
<p>用下面的 create table 语句替换查询窗口的内容。</p>
</li>
<li>
<p>在 <code>tempsensor</code> 数据库中创建一个名为 <code>tempsensoragg</code> 的新表。 如果需要帮助，请参考实验五 - 任务三</p>
<pre class="hljs"><code><div>.create table tempsensoragg (WindowEnd: datetime, AverageTemperature: real)
</div></code></pre>
</li>
</ul>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%BA%8C-%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84-asa-%E4%BD%9C%E4%B8%9A"><strong>任务二: 创建新的 ASA 作业</strong></h3>
<ol>
<li>
<p>转到 Azure 门户主页</p>
</li>
<li>
<p>点击 <strong>创建资源 - Create a resource</strong></p>
</li>
<li>
<p>搜索“stream analytics job”</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/asa-create.png" alt="ASA Create." title="ASA Create"></p>
</li>
<li>
<p>点击 <strong>流分析作业 - Stream Analytics job</strong></p>
</li>
<li>
<p>点击 **创建 - Create **</p>
</li>
<li>
<p>输入作业的详细信息：</p>
<ul>
<li>工作名称 - Job name：<code>asajob-tempagg</code></li>
<li>资源组 - Resource group：<code>rg-iot-academy</code></li>
<li>位置 - Location：您所在的地区，例如 <code>美国东部2</code></li>
<li>托管环境 - Hosting environment：<code>云</code></li>
<li>流媒体单位 - Streaming units：<code>1</code></li>
</ul>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/asa-create-details.png" alt="ASA Create Details." title="ASA Create Details"></p>
</li>
<li>
<p>部署完成后点击<strong>转到资源</strong></p>
</li>
</ol>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%B8%89-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-asa-%E8%BE%93%E5%85%A5"><strong>任务三: 创建一个 ASA 输入</strong></h3>
<ul>
<li>
<p>在另一个 Edge 选项卡中导航到您的 IoT Hub 资源。</p>
</li>
<li>
<p>创建一个名为“asa”的新消费者组。 如果需要帮助，请参考实验五 - 任务四。</p>
</li>
<li>
<p>返回包含 ASA 实例的选项卡。</p>
</li>
<li>
<p>点击<strong>输入 - Inputs</strong>，点击<strong>添加流输入 - Add stream input</strong>，点击<strong>IoT Hub</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/asa-new-input.png" alt="New Input." title="New Input"></p>
</li>
<li>
<p>输入以下内容细节：</p>
<ul>
<li>订阅 - Subscription：您的订阅</li>
<li>IoT Hub：您的 IoT 中心实例</li>
<li>输入别名 - Input alias：<code>vscodeiothub</code></li>
<li>消费者组 - Consumer group：<code>asa</code></li>
<li>端点 - Endpoint：<code>消息</code></li>
<li>所有其他值 - All other values：默认</li>
</ul>
 <br>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/asa-new-input-details.png" alt="Input Details." title="Input Details"></p>
</li>
<li>
<p>点击 <strong>保存 - Save</strong></p>
</li>
</ul>
<h3 id="%E4%BB%BB%E5%8A%A1%E5%9B%9B-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-asa-%E8%BE%93%E5%87%BA"><strong>任务四: 创建一个 ASA 输出</strong></h3>
<ol>
<li>
<p>选择 <strong>输出 - Outputs</strong></p>
</li>
<li>
<p>选择 <strong>添加 Add</strong>, 点击 <strong>Azure Data Explorer</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/asa-new-output.png" alt="New Output." title="New Output"></p>
</li>
<li>
<p>输入以下内容细节:</p>
<ul>
<li>输出别名 - Output alias: <code>adx</code></li>
<li>集群 - Cluster: your cluster created earlier</li>
<li>数据库 - Database: your database created earlier</li>
<li>表格 - Table: <code>tempsensoragg</code></li>
</ul>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/asa-new-output-details.png" alt="New Output Details." title="New Output Details"></p>
</li>
<li>
<p>点击 <strong>保存 - Save</strong></p>
</li>
</ol>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%BA%94-%E5%86%99%E5%85%A5-asa-%E6%9F%A5%E8%AF%A2"><strong>任务五: 写入 ASA 查询</strong></h3>
<ol>
<li>选择 <strong>查询 - Query</strong></li>
<li>复制和粘贴以下语句到查询窗体</li>
</ol>
<pre class="hljs"><code><div><span class="hljs-keyword">SELECT</span> System.Timestamp() <span class="hljs-keyword">AS</span> WindowEnd, <span class="hljs-keyword">avg</span>(ambient.temperature) AverageTemperature
<span class="hljs-keyword">INTO</span> adx
<span class="hljs-keyword">FROM</span> vscodeiothub
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> TumblingWindow(<span class="hljs-keyword">Duration</span>(<span class="hljs-keyword">minute</span>, <span class="hljs-number">1</span>))
</div></code></pre>
<ol start="3">
<li>
<p>点击 <strong>保存查询 - Save query</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/asa-update-query.png" alt="Update Query." title="Update Query"></p>
</li>
<li>
<p>在另一个 Edge 选项卡中导航到您的 IoT 中心实例</p>
</li>
<li>
<p>按照实验六任务一中的说明重置 <strong>SimulatedTemperatureSensor</strong> 模块，以确保发送遥测数据</p>
</li>
<li>
<p>现在回到你的 asa 工作(在另一个打开的 Edge 选项卡中)</p>
</li>
<li>
<p>点击 <strong>测试查询 - Test Query</strong></p>
</li>
<li>
<p>在 <strong>测试结果 - Test Results</strong> 选项卡下查看输出中的结果</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/asa-test-query.png" alt="Test Query." title="Test Query"></p>
</li>
</ol>
<h3 id="%E4%BB%BB%E5%8A%A1%E5%85%AD-%E5%BC%80%E5%A7%8B%E8%B0%83%E5%BA%A6-asa-%E4%BB%BB%E5%8A%A1"><strong>任务六： 开始调度 ASA 任务</strong></h3>
<ol>
<li>
<p>进入 <strong>预览 - Overview</strong> 选项卡</p>
</li>
<li>
<p>选择 <strong>开始 - Start</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/asa-start-job.png" alt="Start Job." title="Start Job"></p>
</li>
<li>
<p>再次选择 <strong>开始 - Start</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/asa-start-job-details.png" alt="Start Job Details." title="Start Job Details"></p>
</li>
<li>
<p>观看通知以确保 ASA 作业成功启动。</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/asa-start-job-success.png" alt="Start Job Success." title="Start Job Success"></p>
</li>
</ol>
<h3 id="%E4%BB%BB%E5%8A%A1%E4%B8%83-%E6%9F%A5%E7%9C%8B-adx-%E4%B8%AD%E6%94%B6%E9%9B%86%E7%9A%84%E8%81%9A%E5%90%88"><strong>任务七: 查看 ADX 中收集的聚合</strong></h3>
<ol>
<li>
<p>在另一个 Edge 选项卡中导航到您的 ADX 资源</p>
</li>
<li>
<p>点击 <strong>查询-Query</strong></p>
</li>
<li>
<p>在下方输入查询</p>
<pre class="hljs"><code><div>tempsensoragg
| take 10 
| order by WindowEnd desc 
</div></code></pre>
</li>
<li>
<p>点击 <strong>运行 - Run</strong></p>
</li>
<li>
<p>10 - 15 分钟后再单击一下 <strong>运行 - Run</strong> ，直到您看到您的数据出现在结果中，如图所示</p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/adx-tempsensoragg-results.png" alt="Tempsensoragg-results." title="Tempsensoragg-results"></p>
</li>
</ol>
<h2 id="%E4%BB%BB%E5%8A%A1%E5%85%AB---%E6%B8%85%E7%A9%BA%E8%B5%84%E6%BA%90"><strong>任务八 - 清空资源</strong></h2>
<p>不要在下一次 Azure IoT Academy 动手实验之前超额使用 Azure 资源，</p>
<ol>
<li>
<p>导航到 Azure 门户主页</p>
</li>
<li>
<p>选择 <strong>资源组 - Resource groups</strong></p>
</li>
<li>
<p>选择 <strong>rg-iot-academy</strong></p>
</li>
<li>
<p>点击 <strong>删除资源组 - Delete resource group</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/resource-group-delete.png" alt="Delete Resource Group." title="Delete Resource Group"></p>
</li>
<li>
<p>键入您的资源组的名称，然后点击 <strong>删除 - Delete</strong></p>
<p><img src="file:///Users/lokinfey/Desktop/iot-academy/Month_1/Day_2/media/resource-group-delete-confirm.png" alt=""></p>
</li>
</ol>

</body>
</html>
